## Структура хранения данных в EEPROM

### 1) Нулевой байт eeprom отведен для стандартных булевых значений:

* 0 - происходила ли инициализация 
* 1 - было ли аварийное выключение
* 2 - вкл/выкл звук 
* 3 - определяет идет работа по предустановленному циклу (PROG=false) или по программе (PROG = true)
* 4 - определяет установлен ли режим безопасного торможения (SAFE = true - установлен)
            
#### Byte: 0x00   
7 | 6 | 5 | 4    | 3    | 2     | 1     | 0    
--- | --- | --- | --- | --- | --- | --- | ---
 x |  x | x | SAFE | PROG | SOUND | EMERG | INIT 
            

### 2) Первый байт 
отведен для установки яркости монитора (0-255) (реально межно было бы запихнуть в 4-7 байт бита 0x00)

### 3) Второй-третий байты 
Хранят информацию о количестве пройденых режимов и то, на каком этапе мы находимся 
Пусть максимальное количество режимов повторения составляет 999. Для хранения этого числа необходимо два байта (реально 10 бит).

Остается шесть (10-15) - для описания номера этапа достаточно первых трех и четвертый будет обозначать направление 
NUM(X) = num_of_elapsed_cycles, STATE(X) = curr_vel_cycle_state

#### Byte 0x03, 0x02
15 (3) | 14 (3) | 13 (3) | 12 (3) | 11 (3) | 10 (3) | 9 (3) | 8 (3) | 7 (2) | 6 (2) | 5 (2)| 4 (2) | 3 (2) | 2 (2) | 1 (2) | 0 (2)
--- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | ---
x   |   x   |  DIR  | STATE2 | STATE1 | STATE0 | NUM9 | NUM8 | NUM7 | NUM6 | NUM5 | NUM4 | NUM3 | NUM2 | NUM1 | NUM0 


### 4) Четвертый байт 
Хранит номер последней программы и точки, на которой система остановилась  (в случае если PROG = 0 информация не 
имееет смысла). Запись ведется только если детектировано аварийное отключение и бит PROG в байте 0x00 равен 1
#### Byte 0x04

7   | 6   | 5   | 4   | 3 | 2     | 1     | 0     
--- | --- | --- | --- | --- | --- | --- | --- 
PT3 | PT2 | PT1 | PT0 | x | PNUM2 | PNUM1 | PNUM0 

### 5) для режима перемешивания
Пусть данные начинаются с start_byte и каждая целая величина занимает SIZE_OF_DATA байт (1 или 2)
тогда:\

* t_accel лежит в start_byte
* v_const лежит в start_byte + SIZE_OF_DATA
* t_const  лежит в start_byte + 2 $\times$ SIZE_OF_DATA
* t_slowdown лежит в start_byte + 3 $\times$ SIZE_OF_DATA
* t_pause лежит в start_byte + 4 $\times$ SIZE_OF_DATA
num_cycles  лежит в start_byte + 5 $\times$ SIZE_OF_DATA
* is_accel_smooth , is_bidirectional лежат соответственно в первом и втором бите байта находящегося 
по адресу start_byte + 6 $\times$ SIZE_OF_DATA (напр 0b00000010 эквивалентен is_accel_smooth = false , 
is_bidirectional = true)\

Таким образом, все данные занимают 5 $\times$ SIZE_OF_DATA + 1 байт

### 6) Данные о программах. 

Участок памяти начинается с байта PROG_FIRST_BYTE = START_BYTE + 5 $\times$ SIZE_OF_DATA + 1 + 1 (последняя единица чисто так на всякий случай)
Для конфигурации на момент 12.05 это байт с адресом 16.\
Структура хранения: у нас будет 8 программ по 16 точек с пятью двухбайтовыми значениями на каждый\
(программа 0){(точка 0){0,1,2,3,4},(точка 1){0,1,2,3,4},...,(точка 15){0,1,2,3,4}},{программа 1},..,{программа 7} 

Tаким образом: 
* адресс k-программы это PROG_FIRST_BYTE + 5 $\times$ k $\times$ SIZE_OF_DATA $\times$ NUM_OF_POINTS (вероятно)
* адресс l-точки в k-программе это PROG_FIRST_BYTE + 5 $\times$ k $\times$ SIZE_OF_DATA $\times$ NUM_OF_POINTS + 5 $\times$ l $\times$ SIZE_OF_DATA (вероятно)
* адресс m-параметра в l-точке в k-программе это PROG_FIRST_BYTE + 5 $\times$ k $\times$ SIZE_OF_DATA $\times$ NUM_OF_POINTS + 5 $\times$ l $\times$ SIZE_OF_DATA + m $\times$ SIZE_OF_DATA (вероятно)
